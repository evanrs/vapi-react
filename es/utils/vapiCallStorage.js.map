{"version":3,"file":"vapiCallStorage.js","sources":["../../src/utils/vapiCallStorage.ts"],"sourcesContent":["import Cookies from 'js-cookie';\n\nexport interface StoredCallData {\n  webCallUrl: string;\n  id?: string;\n  artifactPlan?: {\n    videoRecordingEnabled?: boolean;\n  };\n  assistant?: {\n    voice?: {\n      provider?: string;\n    };\n  };\n  callOptions?: any;\n  timestamp: number;\n}\n\nexport type StorageType = 'session' | 'cookies';\n\n// Get root domain for cookie (e.g., \".domain.com\")\nfunction getRootDomain(): string {\n  const hostname = window.location.hostname;\n\n  // Handle localhost/IP\n  if (\n    hostname === 'localhost' ||\n    hostname === '127.0.0.1' ||\n    /^\\d+\\.\\d+\\.\\d+\\.\\d+$/.test(hostname)\n  ) {\n    return hostname;\n  }\n\n  const parts = hostname.split('.');\n\n  // Already root domain\n  if (parts.length <= 2) {\n    return hostname;\n  }\n\n  // Return root domain with leading dot (e.g., \".domain.com\")\n  return '.' + parts.slice(-2).join('.');\n}\n\nexport const storeCallData = (\n  reconnectStorageKey: string,\n  call: any,\n  callOptions?: any,\n  storageType: StorageType = 'session'\n) => {\n  const webCallUrl =\n    (call as any).webCallUrl || (call.transport as any)?.callUrl;\n\n  if (!webCallUrl) {\n    console.warn(\n      'No webCallUrl found in call object, cannot store for reconnection'\n    );\n    return;\n  }\n\n  const webCallToStore: StoredCallData = {\n    webCallUrl,\n    id: call.id,\n    artifactPlan: call.artifactPlan,\n    assistant: call.assistant,\n    callOptions,\n    timestamp: Date.now(),\n  };\n\n  if (storageType === 'session') {\n    sessionStorage.setItem(reconnectStorageKey, JSON.stringify(webCallToStore));\n  } else if (storageType === 'cookies') {\n    try {\n      const rootDomain = getRootDomain();\n\n      Cookies.set(reconnectStorageKey, JSON.stringify(webCallToStore), {\n        domain: rootDomain,\n        path: '/',\n        secure: true,\n        sameSite: 'lax',\n        expires: 1 / 24, // 1 hour (expires takes days, so 1/24 = 1 hour)\n      });\n    } catch (error) {\n      console.error('Failed to store call data in cookie:', error);\n    }\n  }\n};\n\nexport const getStoredCallData = (\n  reconnectStorageKey: string,\n  storageType: StorageType = 'session'\n): StoredCallData | null => {\n  try {\n    if (storageType === 'session') {\n      const sessionData = sessionStorage.getItem(reconnectStorageKey);\n      if (!sessionData) return null;\n\n      return JSON.parse(sessionData);\n    } else if (storageType === 'cookies') {\n      const cookieValue = Cookies.get(reconnectStorageKey);\n\n      if (!cookieValue) return null;\n\n      return JSON.parse(cookieValue);\n    }\n\n    return null;\n  } catch (error) {\n    console.error('Error reading stored call data:', error);\n    return null;\n  }\n};\n\nexport const clearStoredCall = (\n  reconnectStorageKey: string,\n  storageType: StorageType = 'session'\n) => {\n  if (storageType === 'session') {\n    sessionStorage.removeItem(reconnectStorageKey);\n  } else if (storageType === 'cookies') {\n    const rootDomain = getRootDomain();\n    Cookies.remove(reconnectStorageKey, {\n      domain: rootDomain,\n      path: '/',\n    });\n  }\n};\n\nexport const areCallOptionsEqual = (options1: any, options2: any): boolean => {\n  // Handle null/undefined cases\n  if (options1 === options2) return true;\n  if (!options1 || !options2) return false;\n\n  try {\n    // Deep comparison using JSON serialization\n    // This works for most cases but may not handle functions, dates, etc.\n    return JSON.stringify(options1) === JSON.stringify(options2);\n  } catch {\n    // Fallback to reference equality if JSON.stringify fails\n    return options1 === options2;\n  }\n};\n"],"names":["getRootDomain","hostname","parts","storeCallData","reconnectStorageKey","call","callOptions","storageType","webCallUrl","webCallToStore","rootDomain","Cookies","error","getStoredCallData","sessionData","cookieValue","clearStoredCall","areCallOptionsEqual","options1","options2"],"mappings":";AAoBA,SAASA,IAAwB;AAC/B,QAAMC,IAAW,OAAO,SAAS;AAGjC,MACEA,MAAa,eACbA,MAAa,eACb,uBAAuB,KAAKA,CAAQ;AAEpC,WAAOA;AAGT,QAAMC,IAAQD,EAAS,MAAM,GAAG;AAGhC,SAAIC,EAAM,UAAU,IACXD,IAIF,MAAMC,EAAM,MAAM,EAAE,EAAE,KAAK,GAAG;AACvC;AAEO,MAAMC,IAAgB,CAC3BC,GACAC,GACAC,GACAC,IAA2B,cACxB;AACH,QAAMC,IACHH,EAAa,cAAeA,EAAK,WAAmB;AAEvD,MAAI,CAACG,GAAY;AACf,YAAQ;AAAA,MACN;AAAA,IAAA;AAEF;AAAA,EACF;AAEA,QAAMC,IAAiC;AAAA,IACrC,YAAAD;AAAA,IACA,IAAIH,EAAK;AAAA,IACT,cAAcA,EAAK;AAAA,IACnB,WAAWA,EAAK;AAAA,IAChB,aAAAC;AAAA,IACA,WAAW,KAAK,IAAA;AAAA,EAAI;AAGtB,MAAIC,MAAgB;AAClB,mBAAe,QAAQH,GAAqB,KAAK,UAAUK,CAAc,CAAC;AAAA,WACjEF,MAAgB;AACzB,QAAI;AACF,YAAMG,IAAaV,EAAA;AAEnB,MAAAW,EAAQ,IAAIP,GAAqB,KAAK,UAAUK,CAAc,GAAG;AAAA,QAC/D,QAAQC;AAAA,QACR,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,SAAS,IAAI;AAAA;AAAA,MAAA,CACd;AAAA,IACH,SAASE,GAAO;AACd,cAAQ,MAAM,wCAAwCA,CAAK;AAAA,IAC7D;AAEJ,GAEaC,IAAoB,CAC/BT,GACAG,IAA2B,cACD;AAC1B,MAAI;AACF,QAAIA,MAAgB,WAAW;AAC7B,YAAMO,IAAc,eAAe,QAAQV,CAAmB;AAC9D,aAAKU,IAEE,KAAK,MAAMA,CAAW,IAFJ;AAAA,IAG3B,WAAWP,MAAgB,WAAW;AACpC,YAAMQ,IAAcJ,EAAQ,IAAIP,CAAmB;AAEnD,aAAKW,IAEE,KAAK,MAAMA,CAAW,IAFJ;AAAA,IAG3B;AAEA,WAAO;AAAA,EACT,SAASH,GAAO;AACd,mBAAQ,MAAM,mCAAmCA,CAAK,GAC/C;AAAA,EACT;AACF,GAEaI,IAAkB,CAC7BZ,GACAG,IAA2B,cACxB;AACH,MAAIA,MAAgB;AAClB,mBAAe,WAAWH,CAAmB;AAAA,WACpCG,MAAgB,WAAW;AACpC,UAAMG,IAAaV,EAAA;AACnB,IAAAW,EAAQ,OAAOP,GAAqB;AAAA,MAClC,QAAQM;AAAA,MACR,MAAM;AAAA,IAAA,CACP;AAAA,EACH;AACF,GAEaO,IAAsB,CAACC,GAAeC,MAA2B;AAE5E,MAAID,MAAaC,EAAU,QAAO;AAClC,MAAI,CAACD,KAAY,CAACC,EAAU,QAAO;AAEnC,MAAI;AAGF,WAAO,KAAK,UAAUD,CAAQ,MAAM,KAAK,UAAUC,CAAQ;AAAA,EAC7D,QAAQ;AAEN,WAAOD,MAAaC;AAAA,EACtB;AACF;"}