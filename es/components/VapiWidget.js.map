{"version":3,"file":"VapiWidget.js","sources":["../../src/components/VapiWidget.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useVapiWidget } from '../hooks';\n\nimport { VapiWidgetProps, ColorScheme, StyleConfig } from './types';\n\nimport { sizeStyles, radiusStyles, positionStyles } from './constants';\n\nimport ConsentForm from './widget/ConsentForm';\nimport FloatingButton from './widget/FloatingButton';\nimport WidgetHeader from './widget/WidgetHeader';\nimport AnimatedStatusIcon from './AnimatedStatusIcon';\nimport ConversationMessage from './widget/conversation/Message';\nimport EmptyConversation from './widget/conversation/EmptyState';\nimport VoiceControls from './widget/controls/VoiceControls';\nimport ChatControls from './widget/controls/ChatControls';\nimport HybridControls from './widget/controls/HybridControls';\n\nimport '../styles/animations.css';\n\nconst VapiWidget: React.FC<VapiWidgetProps> = ({\n  publicKey,\n  assistantId,\n  assistant,\n  assistantOverrides,\n  apiUrl,\n  position = 'bottom-right',\n  size = 'full',\n  borderRadius,\n  radius = 'medium', // deprecated\n  mode = 'chat',\n  theme = 'light',\n  // Colors\n  baseBgColor,\n  baseColor, // deprecated\n  accentColor,\n  ctaButtonColor,\n  buttonBaseColor, // deprecated\n  ctaButtonTextColor,\n  buttonAccentColor, // deprecated\n  // Text labels\n  title,\n  mainLabel, // deprecated\n  startButtonText,\n  endButtonText,\n  ctaTitle,\n  ctaSubtitle,\n  // Empty messages\n  voiceEmptyMessage,\n  emptyVoiceMessage = 'Click the start button to begin a conversation', // deprecated\n  voiceActiveEmptyMessage,\n  emptyVoiceActiveMessage = 'Listening...', // deprecated\n  chatEmptyMessage,\n  emptyChatMessage = 'Type a message to start chatting', // deprecated\n  hybridEmptyMessage,\n  emptyHybridMessage = 'Use voice or text to communicate', // deprecated\n  // Chat configuration\n  chatFirstMessage,\n  chatEndMessage,\n  firstChatMessage, // deprecated\n  chatPlaceholder,\n  // Voice configuration\n  voiceShowTranscript,\n  showTranscript = false, // deprecated\n  voiceAutoReconnect = false,\n  voiceReconnectStorage = 'session',\n  reconnectStorageKey = 'vapi_widget_web_call',\n  // Consent configuration\n  consentRequired,\n  requireConsent = false, // deprecated\n  consentTitle,\n  consentContent,\n  termsContent = 'By clicking \"Agree,\" and each time I interact with this AI agent, I consent to the recording, storage, and sharing of my communications with third-party service providers, and as otherwise described in our Terms of Service.', // deprecated\n  consentStorageKey,\n  localStorageKey = 'vapi_widget_consent', // deprecated\n  // Event handlers\n  onVoiceStart,\n  onCallStart, // deprecated\n  onVoiceEnd,\n  onCallEnd, // deprecated\n  onMessage,\n  onError,\n}) => {\n  // Create storage key for expanded state\n  const expandedStorageKey = `vapi_widget_expanded`;\n\n  // Initialize expanded state from localStorage\n  const [isExpanded, setIsExpanded] = useState(() => {\n    try {\n      const stored = sessionStorage.getItem(expandedStorageKey);\n      return stored === 'true';\n    } catch {\n      return false;\n    }\n  });\n\n  const [hasConsent, setHasConsent] = useState(false);\n  const [chatInput, setChatInput] = useState('');\n  const [showEndScreen, setShowEndScreen] = useState(false);\n\n  const conversationEndRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Custom setter that updates both state and localStorage\n  const updateExpandedState = useCallback(\n    (expanded: boolean) => {\n      setIsExpanded(expanded);\n      try {\n        sessionStorage.setItem(expandedStorageKey, expanded.toString());\n      } catch (error) {\n        console.warn('Failed to save expanded state to localStorage:', error);\n      }\n    },\n    [expandedStorageKey]\n  );\n\n  const effectiveBorderRadius = borderRadius ?? radius;\n  const effectiveBaseBgColor = baseBgColor ?? baseColor;\n  const effectiveAccentColor = accentColor ?? '#14B8A6';\n  const effectiveColorButtonBase =\n    buttonBaseColor ?? ctaButtonColor ?? '#000000';\n  const effectiveColorButtonAccent =\n    buttonAccentColor ?? ctaButtonTextColor ?? '#FFFFFF';\n  const effectiveTextWidgetTitle = title ?? mainLabel ?? 'Talk with AI';\n  const effectiveCtaTitle = ctaTitle ?? effectiveTextWidgetTitle;\n  const effectiveCtaSubtitle = ctaSubtitle;\n  const effectiveStartButtonText = startButtonText ?? 'Start';\n  const effectiveEndButtonText = endButtonText ?? 'End Call';\n  const effectiveVoiceEmptyMessage = voiceEmptyMessage ?? emptyVoiceMessage;\n  const effectiveVoiceActiveEmptyMessage =\n    voiceActiveEmptyMessage ?? emptyVoiceActiveMessage;\n  const effectiveChatEmptyMessage = chatEmptyMessage ?? emptyChatMessage;\n  const effectiveHybridEmptyMessage = hybridEmptyMessage ?? emptyHybridMessage;\n  const effectiveChatFirstMessage = chatFirstMessage ?? firstChatMessage;\n  const effectiveVoiceShowTranscript = voiceShowTranscript ?? showTranscript;\n  const effectiveConsentRequired = consentRequired ?? requireConsent;\n  const effectiveConsentTitle = consentTitle;\n  const effectiveConsentContent = consentContent ?? termsContent;\n  const effectiveConsentStorageKey = consentStorageKey ?? localStorageKey;\n  const effectiveOnVoiceStart = onVoiceStart ?? onCallStart;\n  const effectiveOnVoiceEnd = onVoiceEnd ?? onCallEnd;\n  const effectiveChatPlaceholder = chatPlaceholder ?? 'Type your message...';\n  const effectiveChatEndMessage =\n    chatEndMessage ?? 'This chat has ended. Thank you.';\n\n  const vapi = useVapiWidget({\n    mode,\n    publicKey,\n    assistantId,\n    assistant,\n    assistantOverrides,\n    apiUrl,\n    firstChatMessage: effectiveChatFirstMessage,\n    voiceAutoReconnect,\n    voiceReconnectStorage,\n    reconnectStorageKey,\n    onCallStart: effectiveOnVoiceStart,\n    onCallEnd: effectiveOnVoiceEnd,\n    onMessage,\n    onError,\n  });\n\n  const colors: ColorScheme = {\n    baseColor: effectiveBaseBgColor\n      ? theme === 'dark' && effectiveBaseBgColor === '#FFFFFF'\n        ? '#000000'\n        : effectiveBaseBgColor\n      : theme === 'dark'\n        ? '#000000'\n        : '#FFFFFF',\n    accentColor: effectiveAccentColor,\n    ctaButtonColor: effectiveColorButtonBase,\n    ctaButtonTextColor: effectiveColorButtonAccent,\n  };\n\n  const effectiveSize = mode !== 'voice' && size === 'tiny' ? 'compact' : size;\n  const styles: StyleConfig = {\n    size: effectiveSize,\n    radius: effectiveBorderRadius,\n    theme,\n  };\n\n  const showExpandedView = isExpanded && !(mode === 'voice' && size === 'tiny');\n\n  const getExpandedWidgetStyle = (): React.CSSProperties => ({\n    ...sizeStyles[size].expanded,\n    ...radiusStyles[radius],\n    backgroundColor: colors.baseColor,\n    border: `1px solid ${styles.theme === 'dark' ? '#1F2937' : '#E5E7EB'}`,\n    display: 'flex',\n    flexDirection: 'column',\n    overflow: 'hidden',\n    boxShadow:\n      styles.theme === 'dark'\n        ? '0 25px 50px -12px rgba(0, 0, 0, 0.5)'\n        : '0 25px 50px -12px rgb(0 0 0 / 0.25)',\n  });\n\n  const getConversationAreaStyle = (): React.CSSProperties => ({\n    flex: '1 1 0%',\n    padding: '1rem',\n    overflowY: 'auto',\n    backgroundColor: colors.baseColor,\n    ...(styles.theme === 'dark' ? { filter: 'brightness(1.1)' } : {}),\n  });\n\n  const getControlsAreaStyle = (): React.CSSProperties => ({\n    padding: '1rem',\n    borderTop: `1px solid ${styles.theme === 'dark' ? '#1F2937' : '#E5E7EB'}`,\n    backgroundColor: colors.baseColor,\n    ...(styles.theme === 'dark'\n      ? { filter: 'brightness(1.05)' }\n      : { filter: 'brightness(0.97)' }),\n  });\n\n  const getConversationLayoutStyle = (): React.CSSProperties => {\n    const isEmpty = vapi.conversation.length === 0;\n    const hideTranscript =\n      !effectiveVoiceShowTranscript &&\n      vapi.voice.isCallActive &&\n      (mode === 'voice' || mode === 'hybrid');\n    const showingEmptyState = mode === 'voice' && !vapi.voice.isCallActive;\n\n    if (isEmpty || hideTranscript || showingEmptyState) {\n      return {\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n      };\n    }\n\n    return {\n      display: 'flex',\n      flexDirection: 'column',\n      gap: '0.75rem',\n    };\n  };\n\n  useEffect(() => {\n    if (effectiveConsentRequired) {\n      const storedConsent = localStorage.getItem(effectiveConsentStorageKey);\n      const hasStoredConsent = storedConsent === 'true';\n      setHasConsent(hasStoredConsent);\n    } else {\n      setHasConsent(true);\n    }\n  }, [effectiveConsentRequired, effectiveConsentStorageKey]);\n\n  useEffect(() => {\n    conversationEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [vapi.conversation, vapi.chat.isTyping]);\n\n  useEffect(() => {\n    if (isExpanded && (mode === 'chat' || mode === 'hybrid')) {\n      setTimeout(() => {\n        inputRef.current?.focus();\n      }, 100);\n    }\n  }, [isExpanded, mode]);\n\n  const handleConsentAgree = () => {\n    localStorage.setItem(effectiveConsentStorageKey, 'true');\n    setHasConsent(true);\n  };\n\n  const handleConsentCancel = () => {\n    updateExpandedState(false);\n  };\n\n  const handleToggleCall = async () => {\n    await vapi.voice.toggleCall({ force: voiceAutoReconnect });\n  };\n\n  const handleSendMessage = async () => {\n    if (!chatInput.trim()) return;\n\n    const message = chatInput.trim();\n    setChatInput('');\n\n    await vapi.chat.sendMessage(message);\n    inputRef.current?.focus();\n  };\n\n  const handleChatInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    setChatInput(value);\n    vapi.chat.handleInput(value);\n  };\n\n  const handleReset = () => {\n    vapi.clearConversation();\n    setShowEndScreen(false);\n\n    if (vapi.voice.isCallActive) {\n      vapi.voice.endCall({ force: voiceAutoReconnect });\n    }\n\n    setChatInput('');\n\n    if (mode === 'chat' || mode === 'hybrid') {\n      setTimeout(() => {\n        inputRef.current?.focus();\n      }, 100);\n    }\n  };\n\n  const handleChatComplete = async () => {\n    try {\n      await vapi.chat.sendMessage('Ending chat...', true);\n      setShowEndScreen(true);\n    } finally {\n      setChatInput('');\n    }\n  };\n\n  const handleStartNewChat = () => {\n    vapi.clearConversation();\n    setShowEndScreen(false);\n    if (mode === 'chat' || mode === 'hybrid') {\n      setTimeout(() => {\n        inputRef.current?.focus();\n      }, 100);\n    }\n  };\n\n  const handleCloseWidget = () => {\n    if (showEndScreen) {\n      vapi.clearConversation();\n      setShowEndScreen(false);\n      setChatInput('');\n    }\n    updateExpandedState(false);\n  };\n\n  const handleFloatingButtonClick = () => {\n    updateExpandedState(true);\n  };\n\n  const renderConversationMessages = () => {\n    if (vapi.conversation.length === 0) {\n      return (\n        <EmptyConversation\n          mode={mode}\n          isCallActive={vapi.voice.isCallActive}\n          theme={styles.theme}\n          voiceEmptyMessage={effectiveVoiceEmptyMessage}\n          voiceActiveEmptyMessage={effectiveVoiceActiveEmptyMessage}\n          chatEmptyMessage={effectiveChatEmptyMessage}\n          hybridEmptyMessage={effectiveHybridEmptyMessage}\n        />\n      );\n    }\n\n    return (\n      <>\n        {vapi.conversation.map((message, index) => {\n          try {\n            const key = message?.id || `${message.role}-${index}`;\n            return (\n              <ConversationMessage\n                key={key}\n                role={message.role}\n                content={message.content || ''}\n                colors={colors}\n                styles={styles}\n                isLoading={\n                  index === vapi.conversation.length - 1 &&\n                  message.role === 'assistant' &&\n                  vapi.chat.isTyping\n                }\n              />\n            );\n          } catch (error) {\n            console.error('Error rendering message:', error, message);\n            return null;\n          }\n        })}\n        <div ref={conversationEndRef} />\n      </>\n    );\n  };\n\n  const renderConversationArea = () => {\n    if (showEndScreen) {\n      return (\n        <div\n          className=\"flex flex-col items-center justify-center text-center gap-4\"\n          style={{ width: '100%' }}\n        >\n          <div\n            className={`text-base ${styles.theme === 'dark' ? 'text-gray-200' : 'text-gray-800'}`}\n          >\n            {effectiveChatEndMessage}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={handleStartNewChat}\n              className=\"px-3 py-1.5 rounded-md\"\n              style={{\n                backgroundColor: colors.ctaButtonColor,\n                color: colors.ctaButtonTextColor,\n              }}\n            >\n              Start new chat\n            </button>\n            <button\n              onClick={handleCloseWidget}\n              className={`px-3 py-1.5 rounded-md ${styles.theme === 'dark' ? 'bg-gray-800 text-gray-100' : 'bg-gray-100 text-gray-800'}`}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      );\n    }\n    // Chat mode: always show conversation messages\n    if (mode === 'chat') {\n      return renderConversationMessages();\n    }\n\n    // Hybrid mode: show messages when call is not active, respect showTranscript when active\n    if (mode === 'hybrid') {\n      if (!vapi.voice.isCallActive) {\n        return renderConversationMessages();\n      } else if (effectiveVoiceShowTranscript) {\n        return renderConversationMessages();\n      } else {\n        return (\n          <AnimatedStatusIcon\n            size={150}\n            connectionStatus={vapi.voice.connectionStatus}\n            isCallActive={vapi.voice.isCallActive}\n            isSpeaking={vapi.voice.isSpeaking}\n            isTyping={vapi.chat.isTyping}\n            volumeLevel={vapi.voice.volumeLevel}\n            baseColor={colors.accentColor}\n            colors={colors.accentColor}\n          />\n        );\n      }\n    }\n\n    // Voice mode: respect showTranscript when call is active\n    if (mode === 'voice') {\n      if (vapi.voice.isCallActive) {\n        if (effectiveVoiceShowTranscript) {\n          return renderConversationMessages();\n        } else {\n          return (\n            <AnimatedStatusIcon\n              size={150}\n              connectionStatus={vapi.voice.connectionStatus}\n              isCallActive={vapi.voice.isCallActive}\n              isSpeaking={vapi.voice.isSpeaking}\n              isTyping={vapi.chat.isTyping}\n              volumeLevel={vapi.voice.volumeLevel}\n              baseColor={colors.accentColor}\n              colors={colors.accentColor}\n            />\n          );\n        }\n      }\n    }\n\n    // Default: show empty conversation\n    return (\n      <EmptyConversation\n        mode={mode}\n        isCallActive={vapi.voice.isCallActive}\n        theme={styles.theme}\n        voiceEmptyMessage={effectiveVoiceEmptyMessage}\n        voiceActiveEmptyMessage={effectiveVoiceActiveEmptyMessage}\n        chatEmptyMessage={effectiveChatEmptyMessage}\n        hybridEmptyMessage={effectiveHybridEmptyMessage}\n      />\n    );\n  };\n\n  const renderControls = () => {\n    if (showEndScreen) {\n      return null;\n    }\n    if (mode === 'voice') {\n      return (\n        <VoiceControls\n          isCallActive={vapi.voice.isCallActive}\n          connectionStatus={vapi.voice.connectionStatus}\n          isAvailable={vapi.voice.isAvailable}\n          isMuted={vapi.voice.isMuted}\n          onToggleCall={handleToggleCall}\n          onToggleMute={vapi.voice.toggleMute}\n          startButtonText={effectiveStartButtonText}\n          endButtonText={effectiveEndButtonText}\n          colors={colors}\n        />\n      );\n    }\n\n    if (mode === 'chat') {\n      return (\n        <ChatControls\n          chatInput={chatInput}\n          isAvailable={vapi.chat.isAvailable}\n          onInputChange={handleChatInputChange}\n          onSendMessage={handleSendMessage}\n          colors={colors}\n          styles={styles}\n          inputRef={inputRef}\n          placeholder={effectiveChatPlaceholder}\n        />\n      );\n    }\n\n    if (mode === 'hybrid') {\n      return (\n        <HybridControls\n          chatInput={chatInput}\n          isCallActive={vapi.voice.isCallActive}\n          connectionStatus={vapi.voice.connectionStatus}\n          isChatAvailable={vapi.chat.isAvailable}\n          isVoiceAvailable={vapi.voice.isAvailable}\n          isMuted={vapi.voice.isMuted}\n          onInputChange={handleChatInputChange}\n          onSendMessage={handleSendMessage}\n          onToggleCall={handleToggleCall}\n          onToggleMute={vapi.voice.toggleMute}\n          colors={colors}\n          styles={styles}\n          inputRef={inputRef}\n          placeholder={effectiveChatPlaceholder}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  const renderExpandedWidget = () => {\n    if (effectiveConsentRequired && !hasConsent) {\n      return (\n        <ConsentForm\n          consentTitle={effectiveConsentTitle}\n          consentContent={effectiveConsentContent}\n          onAccept={handleConsentAgree}\n          onCancel={handleConsentCancel}\n          colors={colors}\n          styles={styles}\n          radius={radius}\n        />\n      );\n    }\n\n    return (\n      <div style={getExpandedWidgetStyle()}>\n        <WidgetHeader\n          mode={mode}\n          connectionStatus={vapi.voice.connectionStatus}\n          isCallActive={vapi.voice.isCallActive}\n          isSpeaking={vapi.voice.isSpeaking}\n          isTyping={vapi.chat.isTyping}\n          hasActiveConversation={vapi.conversation.length > 0}\n          mainLabel={effectiveTextWidgetTitle}\n          onClose={handleCloseWidget}\n          onReset={handleReset}\n          onChatComplete={handleChatComplete}\n          showEndChatButton={!showEndScreen}\n          colors={colors}\n          styles={styles}\n        />\n\n        {/* Conversation Area */}\n        <div\n          className=\"vapi-conversation-area\"\n          style={{\n            ...getConversationAreaStyle(),\n            ...getConversationLayoutStyle(),\n          }}\n        >\n          {renderConversationArea()}\n        </div>\n\n        {/* Controls Area */}\n        <div style={getControlsAreaStyle()}>{renderControls()}</div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"vapi-widget-wrapper\">\n      <div\n        style={{\n          position: 'fixed',\n          zIndex: 9999,\n          ...positionStyles[position],\n        }}\n      >\n        {showExpandedView ? (\n          renderExpandedWidget()\n        ) : (\n          <FloatingButton\n            isCallActive={vapi.voice.isCallActive}\n            connectionStatus={vapi.voice.connectionStatus}\n            isSpeaking={vapi.voice.isSpeaking}\n            isTyping={vapi.chat.isTyping}\n            volumeLevel={vapi.voice.volumeLevel}\n            onClick={handleFloatingButtonClick}\n            onToggleCall={handleToggleCall}\n            mainLabel={effectiveTextWidgetTitle}\n            ctaTitle={effectiveCtaTitle}\n            ctaSubtitle={effectiveCtaSubtitle}\n            colors={colors}\n            styles={styles}\n            mode={mode}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default VapiWidget;\n"],"names":["VapiWidget","publicKey","assistantId","assistant","assistantOverrides","apiUrl","position","size","borderRadius","radius","mode","theme","baseBgColor","baseColor","accentColor","ctaButtonColor","buttonBaseColor","ctaButtonTextColor","buttonAccentColor","title","mainLabel","startButtonText","endButtonText","ctaTitle","ctaSubtitle","voiceEmptyMessage","emptyVoiceMessage","voiceActiveEmptyMessage","emptyVoiceActiveMessage","chatEmptyMessage","emptyChatMessage","hybridEmptyMessage","emptyHybridMessage","chatFirstMessage","chatEndMessage","firstChatMessage","chatPlaceholder","voiceShowTranscript","showTranscript","voiceAutoReconnect","voiceReconnectStorage","reconnectStorageKey","consentRequired","requireConsent","consentTitle","consentContent","termsContent","consentStorageKey","localStorageKey","onVoiceStart","onCallStart","onVoiceEnd","onCallEnd","onMessage","onError","expandedStorageKey","isExpanded","setIsExpanded","useState","hasConsent","setHasConsent","chatInput","setChatInput","showEndScreen","setShowEndScreen","conversationEndRef","useRef","inputRef","updateExpandedState","useCallback","expanded","error","effectiveBorderRadius","effectiveBaseBgColor","effectiveAccentColor","effectiveColorButtonBase","effectiveColorButtonAccent","effectiveTextWidgetTitle","effectiveCtaTitle","effectiveCtaSubtitle","effectiveStartButtonText","effectiveEndButtonText","effectiveVoiceEmptyMessage","effectiveVoiceActiveEmptyMessage","effectiveChatEmptyMessage","effectiveHybridEmptyMessage","effectiveChatFirstMessage","effectiveVoiceShowTranscript","effectiveConsentRequired","effectiveConsentTitle","effectiveConsentContent","effectiveConsentStorageKey","effectiveOnVoiceStart","effectiveOnVoiceEnd","effectiveChatPlaceholder","effectiveChatEndMessage","vapi","useVapiWidget","colors","styles","showExpandedView","getExpandedWidgetStyle","sizeStyles","radiusStyles","getConversationAreaStyle","getControlsAreaStyle","getConversationLayoutStyle","isEmpty","hideTranscript","showingEmptyState","useEffect","hasStoredConsent","handleConsentAgree","handleConsentCancel","handleToggleCall","handleSendMessage","message","handleChatInputChange","e","value","handleReset","handleChatComplete","handleStartNewChat","handleCloseWidget","handleFloatingButtonClick","renderConversationMessages","jsx","EmptyConversation","jsxs","Fragment","index","key","ConversationMessage","renderConversationArea","AnimatedStatusIcon","renderControls","VoiceControls","ChatControls","HybridControls","renderExpandedWidget","ConsentForm","WidgetHeader","positionStyles","FloatingButton"],"mappings":"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"}